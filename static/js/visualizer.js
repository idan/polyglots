// Generated by CoffeeScript 1.4.0
(function() {
  var chord_diagram, colors, get_language_rank, languages;

  colors = {
    turquoise: "#1abc9c",
    green_sea: "#16a085",
    emerland: "#2ecc71",
    nephritis: "#27ae60",
    peter_river: "#3498db",
    belize_hole: "#2980b9",
    amethyst: "#9b59b6",
    wisteria: "#8e44ad",
    wet_asphalt: "#34495e",
    midnight_blue: "#2c3e50",
    sunflower: "#f1c40f",
    orange: "#f39c12",
    carrot: "#e67e22",
    pumpkin: "#d35400",
    alizarin: "#e74c3c",
    pomegranate: "#c0392b",
    clouds: "#ecf0f1",
    silver: "#bdc3c7",
    concrete: "#95a5a6",
    asbestos: "#7f8c8d"
  };

  languages = [
    {
      "name": "JavaScript",
      "rank": 0,
      "contributors": 6485,
      "contributions": 8343,
      "color": colors.belize_hole
    }, {
      "name": "Ruby",
      "rank": 1,
      "contributors": 11141,
      "contributions": 18026,
      "color": colors.alizarin
    }, {
      "name": "Java",
      "rank": 2,
      "contributors": 4311,
      "contributions": 5184,
      "color": colors.turquoise
    }, {
      "name": "Python",
      "rank": 3,
      "contributors": 6732,
      "contributions": 8785,
      "color": colors.nephritis
    }, {
      "name": "Shell",
      "rank": 4,
      "contributors": 3075,
      "contributions": 3946,
      "color": colors.wisteria
    }, {
      "name": "PHP",
      "rank": 5,
      "contributors": 6174,
      "contributions": 9082,
      "color": colors.peter_river
    }, {
      "name": "C",
      "rank": 6,
      "contributors": 6937,
      "contributions": 18460,
      "color": colors.sunflower
    }, {
      "name": "C++",
      "rank": 7,
      "contributors": 4346,
      "contributions": 5011,
      "color": colors.orange
    }, {
      "name": "Perl",
      "rank": 8,
      "contributors": 2144,
      "contributions": 3224,
      "color": colors.pomegranate
    }, {
      "name": "Obj-C",
      "rank": 9,
      "contributors": 2037,
      "contributions": 2830,
      "color": colors.carrot
    }
  ];

  get_language_rank = function(language) {
    return _.find(languages, function(l) {
      return l.name === language;
    }).rank;
  };

  chord_diagram = function(id, el, width, height, data, lang, labels) {
    var arc, chord, formatPercent, group, groupPath, groupText, innerRadius, layout, mouseover, outerRadius, path, svg;
    if (labels == null) {
      labels = true;
    }
    outerRadius = Math.min(width, height) / 2 - 10;
    innerRadius = outerRadius - 24;
    formatPercent = d3.format(".1%");
    arc = d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius);
    layout = d3.layout.chord().padding(.04).sortSubgroups(d3.descending).sortChords(d3.ascending);
    path = d3.svg.chord().radius(innerRadius);
    svg = d3.select(el).append("svg").attr("width", width).attr("height", height).append("g").attr("id", "circle").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
    svg.append("circle").attr("r", outerRadius);
    layout.matrix(data);
    mouseover = function(d, i) {
      console.log("hover!");
      return chord.classed("fade", function(p) {
        return p.source.index !== i && p.target.index !== i;
      });
    };
    group = svg.selectAll(".group").data(layout.groups).enter().append("g").attr("class", "group");
    group.on('mouseover', mouseover);
    group.append("title").text(function(d, i) {
      return "" + languages[i].name;
    });
    groupPath = group.append("path").attr("id", function(d, i) {
      return "" + id + "_group" + i;
    }).attr("d", arc).style("fill", function(d, i) {
      return languages[i].color;
    });
    if (labels) {
      groupText = group.append("text").attr("x", 6).attr("dy", 15);
      groupText.append("textPath").attr("xlink:href", function(d, i) {
        return "#" + id + "_group" + i;
      }).text(function(d, i) {
        return languages[i].name;
      });
    }
    return chord = svg.selectAll(".chord").data(layout.chords).enter().append("path").attr("class", "chord").style("fill", function(d) {
      return languages[d.source.index].color;
    }).attr("d", path);
  };

  $(function() {
    console.log('domready!');
    d3.json("static/data/language_adjacency.json", function(error, data) {
      chord_diagram('chord_repos', "#polyglot_tendencies>.vis", 500, 500, data.repos);
      chord_diagram('chord_commits', "#polyglot_tendencies>.vis", 500, 500, data.commits);
      chord_diagram('chord_repos_noself', "#polyglot_tendencies>.vis", 500, 500, data.repos_noself);
      chord_diagram('chord_commits_noself', "#polyglot_tendencies>.vis", 500, 500, data.commits_noself);
      chord_diagram('chord_commits_noself2', "#polyglot_tendencies>.vis", 300, 300, data.commits_noself, null, false);
      chord_diagram('chord_commits_people', "#polyglot_tendencies>.vis", 500, 500, data.people);
      return chord_diagram('chord_commits_people_noself', "#polyglot_tendencies>.vis", 500, 500, data.people_noself);
    });
  });

}).call(this);
